function successNotice(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:global_notice_options;toastr.success(e,t,a)}function warningNotice(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:global_notice_options;toastr.warning(e,t,a)}function errorNotice(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:global_notice_options;a.timeOut=3e3;var n=Object.assign({},global_notice_options,a);toastr.error(e,t,n)}function infoNotice(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:global_notice_options;toastr.info(e,t,a)}function closeNotice(){toastr.clear()}function mlib_reload_frame(){window.top.mlib_thumbs_after_upload()}function fillImage(t,e){$(e).parent().find(".img-thumbnail").attr("src",t)}function fillGallery(t,e){var a=t.split(",");$.each(a,function(t,a){$(e).parent().find(".media-container").append('<div class="media-item"><img class="img-thumbnail" src="'+a+'""><span class="close"><i class="fa fa-remove"></i></span></div>')})}function fillSliderImage(t,e){$(e).parent().find("img").attr("src",t)}function createSlugFromKeyword(t){var e=$slug.val(),a=t.toLowerCase().trim().replace(/&/g,"-and-").replace(/(à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ)/g,"a").replace(/(è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ)/g,"e").replace(/(ì|í|ị|ỉ|ĩ)/g,"i").replace(/(ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ)/g,"o").replace(/(ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ)/g,"u").replace(/(ỳ|ý|ỵ|ỷ|ỹ)/g,"y").replace(/(đ)/g,"d").replace(/[^a-z0-9-]+/g,"-").replace(/\-\-+/g,"-").replace(/^-+|-+$/g,"");e!=a&&($slug.val(a),$slug.trigger("change"))}function generateSEO(){$seo_title.val($title.val()),$seo_title.trigger("keyup");var t=$description.attr("id"),e=void 0;void 0==CKEDITOR.instances[t]?e=$description.val():(e=CKEDITOR.instances[t].getData(),e=$(e).text()),$seo_description.val(e),$seo_description.trigger("keyup"),swal.close()}function createRelatedFromKeyword(t){isNotChangeTite&&$title.val(t.charAt(0).toUpperCase()+t.slice(1)),isNotChangeHeading&&$heading.val(t.charAt(0).toUpperCase()+t.slice(1)),isNotChangeMenuName&&$menu_name.val(t.charAt(0).toUpperCase()+t.slice(1)),isNotChangeSeoTite&&($seo_title.val(t.charAt(0).toUpperCase()+t.slice(1)),$seo_title.trigger("keyup"))}function initSEO(){$seo_title.trigger("keyup"),$seo_description.trigger("keyup"),$slug_goole.html($slug.val())}function getDistrict(t,e,a){var n={province_id:e};$.ajax({type:"GET",url:"/api/province/distrist",data:n,success:function(e){var n=document.createElement("option");n.text="Chọn Quận/Huyện*",n.value=null,$(n).attr("data-id",null),$(t).html(n),$.each(e,function(e,n){var i=document.createElement("option");i.text=n.name,i.value=n.name,$(i).attr("data-id",n.id),a==n.name&&$(i).attr("selected",!0),$(t).append(i)})}})}function getProvince(t,e,a,n){$.ajax({type:"GET",url:"/api/province",success:function(i){var o=document.createElement("option");o.text="Chọn Tỉnh/TP",o.value="",$(o).attr("data-id",null),$(t).append(o),$.each(i,function(i,o){var s=document.createElement("option");s.text=o.name,s.value=o.name,$(s).attr("data-id",o.id),a==o.name&&($(s).attr("selected",!0),getDistrict(e,o.id,n)),$(t).append(s)})}}),$(t).change(function(){var t=$(this).find(":selected");getDistrict(e,t.attr("data-id"))})}function getProvinceGHN(t,e,a,n){$.ajax({type:"GET",url:"/api/province",success:function(i){var o=document.createElement("option");o.text="Chọn Tỉnh/TP",o.value="",$(o).attr("data-id",null),$(t).append(o),$.each(i,function(i,o){var s=document.createElement("option");s.text=o.name,s.value=o.ghn_code,a==o.name&&($(s).attr("selected",!0),getDistrictGHN(e,o.ghn_code,n)),$(t).append(s)})}}),$(t).change(function(){var t=$(this).find(":selected");getDistrictGHN(e,t.val())})}function getDistrictGHN(t,e,a){var n={province_id:e};$.ajax({type:"GET",url:"/api/ghn/district",data:n,success:function(e){var a=document.createElement("option");a.text="Chọn Quận/Huyện*",a.value="",$(t).html(a),$.each(e,function(e,a){var n=document.createElement("option");n.text=a.DistrictName,n.value=a.DistrictID,$(t).append(n)})}})}function getStoreGHN(t){$(document).on("change",t,function(){var t=$(this).find(":selected");$("input[name=client_hub_id]").val(t.attr("data-client_hub_id")),$("input[name=client_contact_name]").val(t.attr("data-client_contact_name")),$("input[name=client_contact_phone]").val(t.attr("data-client_contact_phone")),$("input[name=client_address]").val(t.attr("data-client_address"))}),$.ajax({type:"GET",url:"/api/ghn/store",success:function(e){var a=document.createElement("option");a.text="Chọn ...",a.value="",$(t).append(a),$.each(e,function(e,a){var n=document.createElement("option");n.text=a.FullAddress,n.value=a.DistrictID,$(n).attr("data-client_hub_id",a.HubID),$(n).attr("data-client_contact_name",a.ContactName),$(n).attr("data-client_contact_phone",a.ContactPhone),$(n).attr("data-client_address",a.Address),$(t).append(n)})}})}function findAvailableServicesGHN(t,e,a){Number.prototype.padLeft=function(t,e){var a=String(t||10).length-String(this).length+1;return a>0?new Array(a).join(e||"0")+this:this},$(document).on("change",e+", "+a,function(){if($(e).val()&&$(a).val()){var n={FromDistrictID:$(e).val(),ToDistrictID:$(a).val()};$.ajax({type:"GET",url:"/api/ghn/find-available-services",data:n,success:function(e){$(t).html(""),$.each(e,function(e,a){var n=document.createElement("option"),i=new Date(a.ExpectedDeliveryTime),o=[i.getDate().padLeft(),(i.getMonth()+1).padLeft(),i.getFullYear()].join("/")+" "+[i.getHours().padLeft(),i.getMinutes().padLeft()].join(":");n.text=a.Name+" - "+(new Intl.NumberFormat).format(a.ServiceFee)+"đ - Giao hàng dự kiến: "+o,n.value=a.ServiceID,$(t).append(n)})},error:function(e,a,n){$(t).html(""),alert("Địa chỉ không hợp lệ!")}})}})}var global_notice_options={timeOut:1e3,positionClass:"toast-bottom-right"},warningSwal=function(t,e){var a={title:t.title,text:t.message,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",cancelButtonText:"Hủy",confirmButtonText:"OK",closeOnConfirm:!1,html:!1};t.options&&(a=Object.assign(a,t.options)),swal(a,e)},errorSwal=function(t,e){swal(t,e,"error")};mlib_domain="/Modules/Media/Library/mlib/";var mlib_parent_init="",media_ajax_upload="/admin/media/upload",media_ajax_action="/admin/media/action",media_ajax_folder="/admin/media/folders",media_asset_url="/Modules/Media/Assets/",core_asset_url="/Modules/Media/Assets/";if($(document).ready(function(){"1"==mlib_parent_init&&(window.top.mlib_adjust_iframe(),setTimeout("mlib_reload_frame()",500)),$("body").on("click","#addmoreupload",function(){$(this).closest(".mlib-extra-upload").after('<div class="mlib-extra-upload"><input type="file" name="file[]" /> <input type="button" class="mlib_delete_upload" value="x Remove" /></div>'),window.top.mlib_adjust_iframe()}),$("body").on("click",".mlib_delete_upload",function(){$(this).parent().remove(),window.top.mlib_adjust_iframe()})}),!window.jQuery){var script=document.createElement("script");script.type="text/javascript",script.src=media_asset_url+"js/jquery-1.11.1.min.js",document.getElementsByTagName("head")[0].appendChild(script)}var mlib_includes='<link href="'+media_asset_url+'pagination/simplePagination.css" rel="stylesheet" type="text/css" /><link href="'+media_asset_url+'css/mlib.css" rel="stylesheet" type="text/css" /><script src="'+core_asset_url+'dropzone/dropzone.min.js" type="text/javascript"><\/script><script src="'+media_asset_url+'pagination/jquery.simplePagination.js" type="text/javascript"><\/script><script src="'+media_asset_url+'js/mlib.js" type="text/javascript"><\/script>';document.write(mlib_includes);var WBDatatablesClass=function(){this.$table=null,this.cur_datatatable=null,this.moverBtns=null};WBDatatablesClass.prototype={init:function(t,e,a){return this.cur_datatatable=this.datatables(t,e,a),this.clickInputCheckAll(t),this.clickInputCheckSingleRow(t),this.registerElement(t),this.actionEvent(t),this.registerEvents(),this.cur_datatatable},reloadData:function(){this.cur_datatatable.ajax.reload(null,!1)},registerElement:function(t){this.$table=$(t)},registerEvents:function(){$(document).on("click","a.mover",$.proxy(this.clickMoverBtn,this)),this.scrollPaginate()},clickMoverBtn:function(t){var e=this,a=$(t.target).parent(),n=a.attr("href");jQuery.ajax({url:n,type:"PUT",dataType:"json",data:{_token:_token},complete:function(t,e){},success:function(t,a,n){"success"===t.status?(successNotice("Đã di chuyển, đang cập nhật lại thông tin..."),e.cur_datatatable.ajax.reload()):errorNotice("Lỗi, vui lòng kiểm tra kết nối mạng!")},error:function(t,e,a){errorNotice("Lỗi, vui lòng kiểm tra kết nối mạng!")}})},clickInputCheckAll:function(t){$(t).on("click","input#inputCheckAll",function(e){$(t).find("input.check_single_row").prop("checked",$(this).is(":checked")),$(this).is(":checked")?$(t).find("input.check_single_row").parents("tr").addClass("success"):$(t).find("input.check_single_row").parents("tr").removeClass("success"),$.uniform.update()})},clickInputCheckSingleRow:function(t){$(t).on("click","input.check_single_row",function(t){$(this).is(":checked")?$(this).parents("tr").addClass("success"):($("input#inputCheckAll").prop("checked",!1),$(this).parents("tr").removeClass("success")),$.uniform.update()})},deleteCheckedRows:function(t){var e=this;return swal({showLoaderOnConfirm:!0,closeOnConfirm:!1,title:"Bạn có chắc thực hiện thao tác xóa không ?",text:"Bạn sẽ không thể lấy lại được dữ liệu này !",type:"warning",showCancelButton:!0,confirmButtonColor:"#FF7043",cancelButtonText:"Không",confirmButtonText:"Có"},function(){$.ajax({url:e.$table.data("destroymulti"),type:"DELETE",dataType:"json",data:{_token:_token,ids:t},success:function(){swal.close(),e.cur_datatatable.ajax.reload(null,!1)},error:function(t,e,a){swal.close()}})}),!1},activeCheckedRows:function(t){var e=this;return $.ajax({url:e.$table.data("updatemulti"),type:"PATCH",dataType:"json",data:{_token:_token,ids:t,data:{is_published:1}},success:function(t){successNotice(t.message),e.cur_datatatable.ajax.reload(null,!1)},error:function(t,e,a){}}),!1},deActiveCheckedRows:function(t){var e=this;return $.ajax({url:e.$table.data("updatemulti"),type:"PATCH",dataType:"json",data:{_token:_token,ids:t,data:{is_published:0}},success:function(t){successNotice(t.message),e.cur_datatatable.ajax.reload(null,!1)},error:function(t,e,a){}}),!1},updateActive:function(){var t=this;$(document).on("click",".update_field",function(e){var a=$(this).data("action"),n=$(this).data("field"),i=$(this).data("value")?0:1,o={_token:_token};return o[n]=i,$.ajax({url:a,type:"PATCH",dataType:"json",data:o,success:function(e){successNotice("Cập nhập thành công."),t.cur_datatatable.ajax.reload(null,!1)},error:function(){}}),!1})},updatePublisedDate:function(){var t=this;return $(".published_at").daterangepicker({opens:"left",timePicker:!0,timePickerIncrement:30,singleDatePicker:!0,showDropdowns:!0,timePicker24Hour:!0,locale:{format:"DD-MM-YYYY HH:mm:ss"}},function(e){var a=$(this)[0].element.data("action"),n={published_at:moment(e).format("YYYY-MM-DD HH:mm:ss"),_token:_token};$.ajax({url:a,type:"PATCH",dataType:"json",data:n,success:function(e){successNotice(e.message),t.cur_datatatable.ajax.reload(null,!1)},error:function(){}})}),!1},scrollPaginate:function(){$(document).on("click","a.paginate_button",function(){$(this).hasClass("disabled")||$("html, body").animate({scrollTop:$("body").offset().top},1e3)})},datatables:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=this;$.extend($.fn.dataTable.defaults,{autoWidth:!1,serverSide:!0,processing:!0,dom:'<"datatable-header"<"datatable-header-left"><"datatable-header-right"f>><"datatable-scroll"t><"datatable-footer"<"datatable-footer-left col-md-3"i><"datatable-footer-center col-md-6"p><"datatable-footer-right col-md-3"l>>',language:{search:"_INPUT_",searchPlaceholder:"Nhập từ khóa...",lengthMenu:"<span>Hiển thị</span> _MENU_",info:"Hiển thị _START_ đến _END_ trong _TOTAL_ mục",paginate:{first:"First",last:"Last",next:"&rarr;",previous:"&larr;"}}});var i={ajax:{url:$(t).data("source"),data:{}},columns:e,ordering:!1,fnInitComplete:function(t,e){},fnDrawCallback:function(){WBForm.uniform(),n.updatePublisedDate(),n.hideSortBtnAtLastAndFirstRow()}};return $.extend(i,a),$.fn.dataTableExt.sErrMode="throw",$(t).DataTable(i)},showTitle:function(t,e){var a=(arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:"");return t||(t="(Chưa có tiêu đề)"),t=a+t,'<a href="'+e+'">'+t+"</a>&nbsp;&nbsp;"},showThumbnail:function(t){return t||(t="/Modules/Core/Assets/images/no-image.png"),'<img class="thumbnail_datatable" src="'+t+'">'},showPublish:function(t,e,a){var n="",i={inactive:'<span class="label bg-grey-400">Ẩn</span>',active:'<span class="label bg-blue">Hiện</span>',schedule:'<span class="label bg-success-400">Đã lên lịch</span>'};return e&&(n=0==t?i.inactive:moment().isBefore(e)?i.schedule:i.active),'<a data-field="is_published" data-value='+t+' class="update_field" data-action="'+a+'">'+n+'</a><div><a class="published_at text-muted text-size-small" data-field="published_at" data-action="'+a+'">'+e+"</a></div>"},showSelect:function(t){return'<input class="check_single_row" type="checkbox" bs-type="checkbox" name="select_data" value="'+t+'" >'},showRemoveIcon:function(t){return'<a href="'+t+'" class="remove_item text-danger-600" data-title="'+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)+'" data-message="'+(arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)+'"><i class="icon-trash"></i></a>'},showAction:function(){$("div.datatable-header-left").append('<div class="dataTables_action_item"><select class="action_datatable form-control" name="option_apply"><option value="">Chọn tác vụ</option><option value="delete_selected">Xóa chọn</option></select></div><div class="dataTables_action_item"><button type="button" class="btn btn-default button_apply">Áp dụng</button></div>')},showActionActive:function(){$("div.datatable-header").find("select[name=option_apply]:first").append('<option value="active_selected">Hiện lựa chọn</option><option value="deactive_selected">Ẩn lựa chọn</option>')},renderSortOrderColumn:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={up:null,down:null,top:null,bottom:null},a=Object.assign(e,t);return'<div class="mover_td"><a href="'+a.top+'" class="mover move_up text-default" onclick="return false;"><i class="fa fa-angle-double-up" aria-hidden="true"></i></a><a href="'+a.up+'" class="mover move_up text-default" onclick="return false;"><i class="fa fa-angle-up" aria-hidden="true"></i></a><a href="'+a.down+'" class="mover move_down text-default" onclick="return false;"><i class="fa fa-angle-down" aria-hidden="true"></i></a><a href="'+a.bottom+'" class="mover move_down text-default" onclick="return false;"><i class="fa fa-angle-double-down" aria-hidden="true"></i></a></div>'},hideSortBtnAtLastAndFirstRow:function(){var t=this.cur_datatatable.page.info().page+1,e=this.cur_datatatable.page.info().pages;1==t&&this.$table.find("tbody tr:first").find(".move_up").remove(),t==e&&this.$table.find("tbody tr:last").find(".move_down").remove()},addFilter:function(t,e){var a=this,n='<div class="dataTables_filter">'+t+"</div>";$("div#DataTables_Table_0_filter").before(n),$("body").on("change",e,function(){var t=$("body").find(e).val(),n=$("body").find(e).attr("name"),i=a.cur_datatatable.ajax.url();-1===i.indexOf("?")?i+="?"+n+"="+t:i+="&"+n+"="+t,a.cur_datatatable.ajax.url(i).load()})},actionEvent:function(t){var e=this;$(document).on("click","a.button_apply, button.button_apply",function(){var t=$("input.check_single_row:checked"),a=[];if(t.each(function(t){a.push($(this).val())}),a.length){var n=$(document).find("select[name=option_apply]").val();"delete_selected"==n?e.deleteCheckedRows(a):"active_selected"==n?e.activeCheckedRows(a):"deactive_selected"==n&&e.deActiveCheckedRows(a)}})}};var WBDatatables=new WBDatatablesClass,WBFormClass=function(){this.init()};WBFormClass.prototype={init:function(){this.singleDatePicker(),this.multiSelect(),this.selectize(),this.ckeditor(),this.initGallery(),this.initSelecBackgroundImage(),this.uniform(),this.switch()},singleDatePicker:function(){$('input[bs-type="singleDatePicker"]').each(function(){var t=$(this).val(),e=moment(t);e.isValid()&&$(this).val(e.format("DD-MM-YYYY HH:mm:ss"))}),$('input[bs-type="singleDatePicker"]').daterangepicker({opens:"left",timePicker:!0,timePickerIncrement:30,singleDatePicker:!0,showDropdowns:!0,timePicker24Hour:!0,locale:{format:"DD-MM-YYYY HH:mm:ss"}}),$(".remmove_published_datetime").on("click",function(t){t.preventDefault(),$(this).closest("#published_datetime").find("input").val(moment().format("DD-MM-YYYY 00:00"))})},initCkeditor:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],CKEDITOR.replace(t,{customConfig:cke_conf_path+"/config_full.js"})},ckeditor:function(){$(".ckeditor-full").each(function(){CKEDITOR.instances[$(this).attr("id")]||CKEDITOR.replace($(this).attr("id"),{customConfig:cke_conf_path+"/config_full.js"})}),$(".ckeditor-basic").each(function(){CKEDITOR.instances[$(this).attr("id")]||CKEDITOR.replace($(this).attr("id"),{customConfig:cke_conf_path+"/config_min.js"})})},initGallery:function(){$(document).on("mouseover",".media-container .media-item",function(){$(this).find(".close").show()}),$(document).on("mouseleave",".media-container .media-item",function(){$(this).find(".close").hide()}),$(".media-container").each(function(){var t=$(this).parent(".wrap-media").find("input");if(t.val()){var e=$(this);$.each(t.val().split(","),function(t,a){e.append('<div class="media-item"><img class="img-thumbnail" src="'+a+'""><span class="close"><i class="fa fa-remove"></i></span></div>')})}});var t=this;$(document).on("click",".media-container .close",function(e){var a=$(this).closest(".wrap-media");$(this).parent().remove(),t.updateValueGallery(a)})},updateValueGallery:function(t){var e=[];$.each(t.find(".media-container img"),function(){e.push($(this).attr("src"))}),t.find("input:first").val(e)},multiSelect:function(){$("select[bs-type=multiSelect]").selectize({plugins:["remove_button"],persist:!1,maxItems:null,create:!1})},initSelecBackgroundImage:function(){$(document).on("mouseover",".background_select",function(){$(this).find(".remove_thumb").show()}),$(document).on("mouseleave",".background_select",function(){$(this).find(".remove_thumb").hide()}),$(document).on("click","span.remove_thumb",function(t){return $(this).parent().children("input").val(""),$(this).parent().children("img").attr("src","http://placehold.it/50x50"),!1})},selectize:function(){$("select[bs-type=selectize]").selectize({create:!0})},uniform:function(){$("input[bs-type=checkbox]").uniform({radioClass:"choice"}),$("input[bs-type=radio]").uniform({radioClass:"choice"}),$("input[bs-type=file]").uniform({fileButtonClass:"action btn bg-pink-400"})},switch:function(){$("input[bs-type=switch]").bootstrapSwitch()},showError:function(t,e){$(document).find(".help-block").html(""),$(document).find(".form-group").removeClass("has-error"),$(document).find(".input-group").removeClass("has-error"),$.each(e.responseJSON,function(e,a){var n=t.find('input[name="'+e+'"]'),i=n.closest(".form-group"),o=i.find(".input-group"),s=n.closest(".input-group");o.length>1?(s.addClass("has-error"),s.parent().find(".help-block").addClass("text-danger").html(a)):(i.find(".help-block").html(a),i.addClass("has-error"))});var a=Object.keys(e.responseJSON).length;t.find(".alert-danger").parent().remove(),t.prepend('<div class="col-xs-12"><div class="alert alert-danger alert-styled-left alert-bordered"><button type="button" class="close" data-dismiss="alert"><span>×</span><span class="sr-only">Close</span></button>Có '+a+" lỗi xảy ra trên trang</div></div>")},_empty:function(){}};var WBForm=new WBFormClass,WBSeoClass=function(){this.default_data={title:"",description:"",content:"",seo_title:"",seo_keyword:"",seo_description:"",url:"",heading:"",heading_description:""},this.result={},this.default_config={detail_page:{min_keyword_ratio_in_sentence:.8,title:{keyword_ratio:[{from:1.01,to:1e3,is_pass:!1,status:"too_many"},{from:.7,to:1,is_pass:!0,status:"good"},{from:.5,to:.69,is_pass:!0,status:"few"},{from:0,to:.49,is_pass:!1,status:"too_few"}]},description:{keyword_ratio:[{from:0,to:.79,is_pass:!1,status:"too_few"},{from:.8,to:1,is_pass:!0,status:"good"},{from:1.01,to:9999,is_pass:!0,status:"too_many"}],recommended_keyword_appear_time:{min:1,max:1}},content:{keyword_ratio:[{from:0,to:.009999,status:"too_few"},{from:.01,to:.029999,status:"few"},{from:.03,to:.069999,status:"good"},{from:.07,to:.089999,status:"many"},{from:.09,to:1,status:"too_many"}]},seo_keywords:{range_of_words:[{from:0,to:4,is_pass:!1,status:"too_short_keyword"},{from:4,to:11,is_pass:!0,status:"good"},{from:11,to:1e4,is_pass:!1,status:"too_long_keyword"}]},seo_title:{maximum_words:70,keyword_ratio:[{from:0,to:.59,status:"too_few"},{from:.6,to:.79,status:"few"},{from:.8,to:1,status:"good"},{from:1.01,to:9999,is_pass:!0,status:"too_many"}]},seo_description:{maximum_words:160,keyword_ratio:[{from:0,to:.089,status:"too_few"},{from:.09,to:.149,status:"few"},{from:.15,to:.199,status:"good"},{from:.2,to:.279,status:"many"},{from:.28,to:1,status:"too_many"}]},url:{keyword_ratio:[{from:.8,to:1,status:"good"},{from:.6,to:.79,status:"few"},{from:0,to:.59,status:"too_few"}]}},menu_page:{min_keyword_ratio_in_sentence:.8,title:{keyword_ratio:[{from:1.01,to:1e3,is_pass:!1,status:"too_many"},{from:.7,to:1,status:"good"},{from:.5,to:.69,status:"few"},{from:0,to:.49,status:"too_few"}]},heading:{keyword_ratio:[{from:0,to:.59,status:"too_few"},{from:.6,to:.79,status:"few"},{from:.8,to:1,status:"good"},{from:1.01,to:9999,status:"too_many"}]},description:{keyword_ratio:[{from:0,to:.149,status:"too_few"},{from:.15,to:.249,status:"few"},{from:.25,to:.349,status:"good"},{from:.35,to:.449,status:"many"},{from:.45,to:1,status:"too_many"}]},seo_title:{maximum_words:70,keyword_ratio:[{from:0,to:.59,status:"too_few"},{from:.6,to:.79,status:"few"},{from:.8,to:1,status:"good"}]},seo_description:{maximum_words:160,keyword_ratio:[{from:0,to:.149,status:"too_few"},{from:.15,to:.249,status:"few"},{from:.25,to:.349,status:"good"},{from:.35,to:.449,status:"many"},{from:.45,to:1,status:"too_many"}]},heading_description:{maximum_words:160,keyword_ratio:[{from:0,to:.149,status:"too_few"},{from:.15,to:.249,status:"few"},{from:.25,to:.349,status:"good",message:"Bạn làm rất chuẩn"},{from:.35,to:.449,status:"many"},{from:.45,to:1,status:"too_many"}]},seo_keywords:{range_of_words:[{from:0,to:4,is_pass:!1,status:"too_few"},{from:4,to:11,is_pass:!0,status:"good"},{from:11,to:1e4,is_pass:!1,status:"too_many"}]},url:{keyword_ratio:[{from:.8,to:1,status:"good"},{from:.6,to:.79,status:"few"},{from:0,to:.59,status:"too_few"}]}}},this.message={too_few:{text:"Bạn rải từ khóa quá ít, cần rải thêm.",class:"text-danger"},few:{text:"Bạn rải từ khóa hơi ít, nên rải thêm nhé",class:"text-warning"},good:{text:"Bạn làm rất chuẩn",class:"text-success"},many:{text:"Bạn rải từ khóa hơi nhiều, nên giảm bớt lại nhé",class:"text-warning"},too_many:{text:"Bạn rải từ khóa quá nhiều, cần giảm bớt lại",class:"text-danger"},keyword_must_be_the_same:{text:"Keyword phải gồm 2 từ có dấu và không dấu giống nhau",class:"text-danger"},too_short_keyword:{text:"Keyword quá ngắn, keyword chuẩn nên dài từ 4 ~ 10 từ bạn nhé",class:"text-danger"},too_long_keyword:{text:"Keyword quá dài, keyword chuẩn nên dài từ 4 ~ 10 từ bạn nhé",class:"text-danger"},keyword_must_not_empty:{text:"Keyword không được để trống",class:"text-danger"},bad_keyword_length:{text:"Keyword phải có độ dài từ 4 ~ 10 từ",class:"text-danger"},empty_content:{text:"Nội dung trống, không thể check chuẩn seo",class:"text-danger"},warning:{text:"Bạn làm gần tốt",class:"text-warning"},bad:{text:"Bạn cần tối ưu lại",class:"text-danger"},empty:{text:"Phần này không được để trống",class:"text-danger"}}};WBSeoClass.prototype={REGEX_SPLIT_KEYWORD:/[,;:!?.()\"\...]+/,REGEX_SPLIT_SENTENCE:/[,;!?.\n\...]+/,REGEX_SPLIT_WORD:/[\s,]+/,REGEX_REMOVE_SYMBOL:/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,setFinalResult:function(t){Object.assign(this.result,t)},checkSeoMenuPage:function(t){this.config=this.default_config.menu_page,this.data=Object.assign(this.default_data,t);var e=this;return this.checkSeoKeyword().then(function(){return e.checkMenuHeading(),e.checkMenuHeadingDescription(),e.checkSeoTitle(),e.checkSeoUrl(),e.checkSeoDescription(),e.parseResult()}).catch(function(t){return e.parseResult()})},checkSeoDetailPage:function(t){this.config=this.default_config.detail_page,this.data=Object.assign(this.default_data,t);var e=this;return this.checkSeoKeyword().then(function(){return e.checkDocumentTitle(),e.checkDocumentDescription(),e.checkDocumentContent(),e.checkSeoTitle(),e.checkSeoUrl(),e.checkSeoDescription(),e.parseResult()}).catch(function(t){return e.parseResult()})},parseResult:function(){var t=this,e={},a="good";return Object.keys(this.result).forEach(function(n){var i=t.result[n].status,o='<span class="'+t.message[i].class+' seo_result">'+t.message[i].text+"</span>";e[n]=o,"text-danger"==t.message[i].class?a="bad":"text-warning"==t.message[i].class&&"bad"!=a&&(a="warning")}),e.final_result='<span class="'+t.message[a].class+' seo_result pull-right">'+t.message[a].text+"</span>",e},checkDocumentTitle:function(){var t=this.data.seo_keyword[0],e=this.normalizeContent(this.data.title);if(0==e.length)return void this.setFinalResult({title:{status:"empty"}});for(var a=this.calculateAppearanceRatio(t,e),n=this.config.title.keyword_ratio,i=0;i<n.length;i++){var o=n[i];if(this.inRange(o,a))return void this.setFinalResult({title:{status:o.status}})}},checkMenuHeading:function(){var t=this.data.seo_keyword[0],e=this.normalizeContent(this.data.heading);if(0==e.length)return void this.setFinalResult({heading:{status:"empty"}});for(var a=this.calculateAppearanceRatio(t,e),n=this.config.heading.keyword_ratio,i=0;i<n.length;i++){var o=n[i];if(this.inRange(o,a))return void this.setFinalResult({heading:{status:o.status}})}},checkMenuHeadingDescription:function(){var t=this.normalizeContent(this.data.heading_description);if(0==t.length)return void this.setFinalResult({heading_description:{status:"empty"}});var e=this.data.seo_keyword[0],a=this.splitContentToSentence(t),n=this.countWords(t),i=(this.countWords(e),0);a=this.removeSortSentence(a);for(var o=0;o<a.length;o++)i+=this.calculateNumOfKeywordInSentence(e,a[o]);for(var s=i/n,r=this.config.heading_description.keyword_ratio,c=0;c<r.length;c++){var l=r[c];if(this.inRange(l,s))return void this.setFinalResult({heading_description:{status:l.status}})}},checkDocumentDescription:function(){var t=(!(arguments.length>0&&void 0!==arguments[0])||arguments[0],this.normalizeContent(this.data.description));0==t.length&&this.setFinalResult({description:{status:"empty"}});var e=this.data.seo_keyword[0],a=0,n=this.config.description.keyword_ratio,i=this.splitContentToSentence(t);i=this.removeSortSentence(i);for(var o=0;o<i.length;o++)for(var s=this.calculateAppearanceRatio(e,i[o]),r=0;r<n.length;r++){var c=n[r];this.inPassedRange(c,s)&&a++}var l=this.config.description.recommended_keyword_appear_time.min,d=this.config.description.recommended_keyword_appear_time.max;return a<l?this.setFinalResult({description:{status:"too_few"}}):a>d?this.setFinalResult({description:{status:"too_many"}}):this.setFinalResult({description:{status:"good"}}),!0},checkDocumentContent:function(){var t=this.normalizeContent(this.data.content);if(0==t.length)return void this.setFinalResult({content:{status:"empty"}});var e=this.countWords(t),a=this.splitContentToSentence(t);a=this.removeSortSentence(a);var n=this.normalizeContent(this.data.description),i=this.countWords(n),o=this.splitContentToSentence(n),s=this.data.seo_keyword[0],r=this.countWords(s),c=0,l=e+i,d=0;if(0==i)return void this.setFinalResult({content:{status:"empty_content"}});for(var u=0;u<o.length;u++)this.calculateNumOfKeywordInSentence(s,o[u])>0&&d++;for(var p=0,h=0;h<a.length;h++)p+=this.calculateNumOfKeywordInSentence(s,a[h])/r;var m=this.config.content.keyword_ratio,f=p+d,g=l/(20*r)-1;if(showRecommendedKeywordAppearTime(Math.round(g)),0==p)return void this.setFinalResult({content:{status:"too_few"}});c=f*r/l;for(var _=0;_<m.length;_++){var v=m[_];if(this.inRange(v,c))return void this.setFinalResult({content:{status:v.status}})}},checkSeoTitle:function(){var t=this.normalizeContent(this.data.seo_title);if(0==t.length)return void this.setFinalResult({seo_title:{status:"empty"}});for(var e=this.data.seo_keyword[0],a=this.config.seo_title.keyword_ratio,n=this.calculateAppearanceRatio(e,t),i=0;i<a.length;i++){var o=a[i];if(this.inRange(o,n))return void this.setFinalResult({seo_title:{status:o.status}})}},checkSeoUrl:function(){var t=this.normalizeContent(this.data.url);if(0==t.length)return void this.setFinalResult({url:{status:"empty"}});t=this.splitUrlToSentence(t);var e=this.data.seo_keyword[0];e=this.removeAccent(e);for(var a=this.config.url.keyword_ratio,n=this.calculateAppearanceRatio(e,t),i=0;i<a.length;i++){var o=a[i];if(this.inRange(o,n))return void this.setFinalResult({url:{status:o.status}})}},checkSeoDescription:function(){var t=this.normalizeContent(this.data.seo_description);if(0==t.length)return void this.setFinalResult({seo_description:{status:"empty"}});var e=this.data.seo_keyword[0],a=this.splitContentToSentence(t),n=this.countWords(t),i=(this.countWords(e),0);a=this.removeSortSentence(a);for(var o=0;o<a.length;o++)i+=this.calculateNumOfKeywordInSentence(e,a[o]);for(var s=i/n,r=this.config.seo_description.keyword_ratio,c=0;c<r.length;c++){var l=r[c];if(this.inRange(l,s))return void this.setFinalResult({seo_description:{status:l.status}})}},checkSeoKeyword:function(){var t=this;return new Promise(function(e,a){var n=t.data.seo_keyword,i=t.splitContentToKeyword(n);if(t.config.seo_keywords.num_of_keywords,0==n.length)return t.setFinalResult({seo_keyword:{status:"keyword_must_not_empty"}}),a("keyword_must_not_empty");for(var o=null,s=null,r=0;null==o&&r<i.length;){for(var c=i[r],l=t.countWords(c),d=t.config.seo_keywords.range_of_words,u=0;u<d.length;u++){var p=d[u];if(p.from<=l&&l<p.to){if(!1===p.is_pass)break;s=c;var h=t.getSameKeywordInTheOthers(s,i);if(null==h)break;o=t.removeAccent(s)==s?h:s}}r++}return null==s?(t.setFinalResult({seo_keyword:{status:"bad_keyword_length"}}),a("bad_keyword_length")):(null==o&&(o=s),t.data.seo_keyword=[o],t.setFinalResult({seo_keyword:{status:"good"}}),e())})},getSameKeywordInTheOthers:function(t,e){t=t.toLowerCase();for(var a=this.removeAccent(t),n=0;n<e.length;n++)if(e[n]!=t&&a==this.removeAccent(e[n].toLowerCase()))return e[n];return null},inRange:function(t,e){return t.from<=e&&e<=t.to},inPassedRange:function(t,e){if(t.from<=e&&e<=t.to)return 1==t.is_pass},normalizeContent:function(t){var e=document.createElement("DIV");return e.innerHTML=t,(e.textContent||e.innerText).toLowerCase().trim()},splitContentToSentence:function(t){for(var e=t.split(this.REGEX_SPLIT_SENTENCE),a=e.length-1;a>=0;a--)e[a]=e[a].trim();return e},splitUrlToSentence:function(t){return t.replace(/(-)/g," ")},splitContentToKeyword:function(t){for(var e=t.split(this.REGEX_SPLIT_KEYWORD),a=e.length-1;a>=0;a--)e[a]=e[a].trim();return e},removeSortSentence:function(t){for(var e=t.length-1;e>=0;e--)this.countWords(t[e])<3&&t.splice(e,1);return t},countWords:function(t){return t.trim().split(" ").length},removeAccent:function(t){
return t.replace(/(à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ|&aacute;|&agrave;|&acirc;|&atilde;)/g,"a").replace(/(è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ|&eacute;|&ecirc;)/g,"e").replace(/(ì|í|ị|ỉ|ĩ|&iacute;|&igrave;)/g,"i").replace(/(ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ|&oacute;|&ocirc;|&ograve;)/g,"o").replace(/(ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ|&uacute;|&ugrave;)/g,"u").replace(/(ỳ|ý|ỵ|ỷ|ỹ|&yacute;)/g,"y").replace(/(đ)/g,"d").replace(/(À|Á|Ạ|Ả|Ã|Â|Ầ|Ấ|Ậ|Ẩ|Ẫ|Ă|Ằ|Ắ|Ặ|Ẳ|Ẵ|&Aacute;|&Agrave;|&Acirc;|&Atilde;)/g,"A").replace(/(È|É|Ẹ|Ẻ|Ẽ|Ê|Ề|Ế|Ệ|Ể|Ễ|&Eacute;|&Ecirc;)/g,"E").replace(/(Ì|Í|Ị|Ỉ|Ĩ|&Iacute;|&Igrave;)/g,"I").replace(/(Ò|Ó|Ọ|Ỏ|Õ|Ô|Ồ|Ố|Ộ|Ổ|Ỗ|Ơ|Ờ|Ớ|Ợ|Ở|Ỡ|&Oacute;|&Ocirc;|&Ograve;)/g,"O").replace(/(Ù|Ú|Ụ|Ủ|Ũ|Ư|Ừ|Ứ|Ự|Ử|Ữ|&Uacute;|&Ugrave;)/g,"U").replace(/(Ỳ|Ý|Ỵ|Ỷ|Ỹ|&Yacute;)/g,"Y").replace(/(Đ)/g,"D").replace(/(&nbsp;)/g,"")},removeSymbol:function(t){return t.replace(this.REGEX_REMOVE_SYMBOL,"")},splitContentToWord:function(t){for(var e=t.split(this.REGEX_SPLIT_WORD),a=e.length-1;a>=0;a--)e[a]=e[a].trim(),e[a]=this.removeSymbol(e[a]);return e},calculateAppearanceRatio:function(t,e){for(var a=this.splitContentToWord(t),n=this.splitContentToWord(e),i=0,o=(this.countWords(e),a.length),s=0,r=this.config.min_keyword_ratio_in_sentence,c=n.length/(a.length*r),l=0;l<c;l++){i=0;for(var d=0;d<a.length;d++)this.wordInSentence(a[d],e)&&(e=e.replace(a[d],""),i++);var u=i/o;s+=u>=r?u:0}return s},wordInSentence:function(t,e){return t=t.toLowerCase(),e=e.toLowerCase(),e.search(t)>=0},calculateNumOfKeywordInSentence:function(t,e){var a=this.calculateAppearanceRatio(t,e);if(a<this.config.min_keyword_ratio_in_sentence)return 0;var n=this.splitContentToWord(t);return parseInt(n.length*a)}};var WBSeo=new WBSeoClass,$menu_name=$('input[data-seo="menu_name"]'),$title=$('input[data-seo="title"]'),$description=$('[data-seo="description"]'),$heading=$('[data-seo="heading"]'),$heading_description=$('[data-seo="heading_description"]'),$content=$('[data-seo="content"]'),$seo_title=$('input[data-seo="seo_title"]'),$seo_keyword=$('input[data-seo="seo_keyword"]'),$seo_description=$('textarea[data-seo="seo_description"]'),$slug=$('input[data-seo="slug"]'),$seo_id=$('input[name="seo_id"]'),$seo_title_google=$(".seo_title_google"),$slug_goole=$(".slug_google"),$seo_description_google=$(".seo_description_google");$("#btnCheckSeo").on("click",function(t){var e=$title.val(),a=$description.attr("id"),n=void 0;n=void 0==CKEDITOR.instances[a]?$description.val():CKEDITOR.instances[a].getData();var i=$content.attr("id"),o=void 0;o=void 0==CKEDITOR.instances[i]?$content.val():CKEDITOR.instances[i].getData();var s=$seo_title.val(),r=$seo_keyword.val(),c=$seo_description.val(),l=$slug.val(),d=$('input[data-seo="heading"]').val(),u=$heading_description.val();null==d||void 0==d?WBSeo.checkSeoDetailPage({title:e,description:n,content:o,seo_title:s,seo_keyword:r,seo_description:c,url:l}).then(function(t){showSeoResult(t)}):WBSeo.checkSeoMenuPage({seo_title:s,seo_keyword:r,seo_description:c,url:l,heading:d,heading_description:u}).then(function(t){showSeoResult(t)})});var showRecommendedKeywordAppearTime=function(t){t<0&&(t=0);var e='<span class="keyword-suggestion"> (Bạn nên rải từ khóa trung bình '+parseInt(t)+" lần trong đoạn này)</span>";$(document).find(".keyword-suggestion").remove(),setTimeout(function(){$('textarea[data-seo="content"]').parent().append(e)},200)},clearRecommendedKeywordAppearTime=function(){$(".recommended-keyword-appear-time-label").html("")},showSeoResult=function(t){$(document).find(".seo_result").remove(),$(document).find(".help-block").html(""),Object.keys(t).forEach(function(e){$('[data-seo="'+e+'"]').parent().append(t[e])}),$(t.final_result).appendTo("#finalResult")};$seo_keyword.selectize({delimiter:",",presist:!1,addPrecedence:!0,create:function(t){return{value:t,text:t}},onChange:function(t){var e=t.split(",");e[0]&&createSlugFromKeyword(e[0]),e[0]&&createRelatedFromKeyword(e[0])},render:{option_create:function(t,e){return'<div class="create">Thêm <strong>'+e(t.input)+"</strong>&hellip;</div>"}}}),$seo_title.on("keyup",function(){var t=$(this).val();$("#count_meta_title").html(t.length);var e="Tiêu đề seo website không vượt quá 70 kí tự (tốt nhất từ 60-70 kí tự)";t&&(e=t),e.length>70&&(e=e.substr(0,67)+"..."),$seo_title_google.html(e)}),$seo_description.on("keyup",function(){var t=$(this).val();$("#count_meta_description").html(t.length);var e="Miêu tả seo website không vượt quá 160 kí tự. Là những đoạn mô tả ngắn gọn về website, bài viết...";t&&(e=t),e.length>160&&(e=e.substr(0,160)),$seo_description_google.html(e)}),$slug.on("change",function(t){t.preventDefault();var e=$(this),a=e.val();jQuery.ajax({url:"/admin/seo/slug/check-unique",type:"POST",dataType:"json",data:{_token:_token,slug:a,id:$seo_id.val()},complete:function(t,e){},success:function(t,n,i){var o="";t.success&&!t.unique?(o=a+"-"+Math.floor(1e3*Math.random())+1,e.val(o),e.parent().addClass("has-warning"),e.next("span").append('URL theo từ khóa "'+a+'" đã bị trùng, hãy tạo URL mới theo từ khóa liên quan nhé.')):(o=a,e.parent().removeClass("has-warning"),e.next("span").html("")),$slug_goole.html(o)},error:function(t,e,a){}})}),$("#generate_seo").click(function(){$seo_title.val()||$seo_description.val()?warningSwal({title:"Nội dung SEO đã có sẵn, bạn có chắc chắn thay đổi không ?"},generateSEO):generateSEO()});var isNotChangeTite=""===$title.val(),isNotChangeHeading=""===$heading.val(),isNotChangeMenuName=""===$menu_name.val(),isNotChangeSeoTite=""===$seo_title.val(),isNotChangeSeoDescription=""===$seo_description.val();$title.change(function(){if(isNotChangeSeoTite&&($seo_title.val($title.val()),$seo_title.trigger("keyup")),""===$(this).val())return void(isNotChangeTite=!0);isNotChangeTite=!1}),$menu_name.change(function(){if(""===$(this).val())return void(isNotChangeMenuName=!0);isNotChangeMenuName=!1}),$seo_title.change(function(){if(""===$(this).val())return void(isNotChangeSeoTite=!0);isNotChangeSeoTite=!1}),$seo_description.change(function(){if(""===$(this).val())return void(isNotChangeSeoDescription=!0);isNotChangeSeoDescription=!1}),$heading_description.on("change",function(){isNotChangeSeoDescription&&($seo_description.val($(this).val()),$seo_description.trigger("keyup"))}),void 0==CKEDITOR.instances[$description.attr("id")]?$description.on("change",function(){isNotChangeSeoDescription&&($seo_description.val($(this).val()),$seo_description.trigger("keyup"))}):CKEDITOR.instances[$description.attr("id")].on("change",function(){if(isNotChangeSeoDescription){var t=CKEDITOR.instances[$description.attr("id")].getData();$seo_description.val($(t).text()),$seo_description.trigger("keyup")}}),initSEO(),$.extend($.fn.DataTable.defaults,{autoWidth:!1,dom:'<"datatable-header"fl><"datatable-scroll"t><"datatable-footer"ip>',language:{search:"<span>Filter:</span> _INPUT_",searchPlaceholder:"Type to filter...",lengthMenu:"<span>Show:</span> _MENU_",paginate:{first:"First",last:"Last",next:"&rarr;",previous:"&larr;"}}});var WbApplyTableClass=function(){this.config={source:null,model:"single",applied_ids:[],ajax:null},this.num_of_applied=0};WbApplyTableClass.prototype={SUPPORTED_SOURCE_AJAX_MAP:{post:"/admin/apply-datatables/post","post-category":"/admin/apply-datatables/post-category","post-group":"/admin/apply-datatables/post_group",product:"/admin/apply-datatables/product","product-category":"/admin/apply-datatables/product-category","product-group":"/admin/apply-datatables/product-group"},init:function(t){return this.validateConfig(t)?(this.applyConfig(t),this.num_of_applied=this.config.applied_ids.length,this.initElements(),this.createSearchTable(),"multi"==this.config.model&&this.createApplyTable(),this.registerEvents(),this.showApplyBox(),this.$container.find("#btnShowSearchBox").html('Hiện khung tìm kiếm<span class="caret"></span>')):errorSwal("Lỗi","Xảy ra lỗi khi khởi tạo danh sách áp dụng, vui lòng liên hệ Admin!"),this},validateConfig:function(t){return!!t.source&&"string"==typeof t.source&&("single"==t.model||"multi"==t.model)&&t.source in this.SUPPORTED_SOURCE_AJAX_MAP},applyConfig:function(t){this.config.source=t.source,this.config.model=t.model,this.config.applied_ids=t.applied_ids||[],this.config.ajax=t.ajax||this.mapSupportedAjaxSource()},mapSupportedAjaxSource:function(){var t=this.config.source;return this.SUPPORTED_SOURCE_AJAX_MAP[t]},initElements:function(){this.$container=$("#bsApplyTableContainer"),this.$searchTable=this.$container.find("#searchTable"),this.$appliedTable=this.$container.find("#appliedTable"),this.$inputAppliedIds=this.$container.find("#inputAppliedIds")},registerEvents:function(){$(document).on("click","#searchTable tr",$.proxy(this.applyItem,this)),$(document).on("click",".btn_unapply",$.proxy(this.unapplyItem,this))},createSearchTable:function(){var t=this;$.fn.DataTable.isDataTable("#searchTable")&&this.$searchDatatables.destroy(),this.$searchDatatables=this.$searchTable.DataTable({serverSide:!0,lengthChange:!1,processing:!0,ordering:!1,info:!1,pageLength:5,ajax:t.updateAjaxSource("out_ids"),columns:[t.loadImageColumn(),t.loadDescriptionColumn()],fnDrawCallback:function(){t.$searchTable.find("thead").hide()}})},reloadSearchTable:function(){var t=this.updateAjaxSource("out_ids");this.$searchDatatables.ajax.url(t).draw()},createApplyTable:function(){this.$appliedTable.removeClass("hidden");var t=this;$.fn.DataTable.isDataTable("#appliedTable")&&this.$appliedDatatables.destroy(),this.$appliedDatatables=this.$appliedTable.DataTable({serverSide:!0,searching:!1,info:!0,lengthChange:!1,ajax:t.updateAjaxSource("in_ids"),pageLength:10,columns:[t.loadImageColumn(),t.loadDescriptionColumn(),{className:"text-center",orderable:!1,searchable:!1,width:"30%",data:null,render:function(t){return'<button type="button" class="btn btn-xs btn-danger btn_unapply" data-id="'+t.id+'"><i class="fa fa-remove"></i></button>'}}]})},reloadApplyTable:function(){var t=this.updateAjaxSource("in_ids");this.$appliedDatatables.ajax.url(t).draw()},writeAppliedIdToInput:function(){this.$inputAppliedIds.val(this.config.applied_ids)},loadDescriptionColumn:function(){return"product"==this.config.source||"post-category"==this.config.source||"product-category"==this.config.source||"post"==this.config.source?{data:null,orderable:!0,name:"description.title",render:function(t){return'<input type="hidden" value="'+t.id+'"> '+t.description.title}}:"product-group"==this.config.source||"post-group"==this.config.source?{data:null,orderable:!0,name:"title",render:function(t){return'<input type="hidden" value="'+t.id+'"> '+t.title}}:{data:null,orderable:!0,searchable:!1,render:function(t){return""}}},loadImageColumn:function(){return"product"==this.config.source||"post"==this.config.source?{data:null,name:"thumbnail",orderable:!0,searchable:!1,render:function(t){return'<img style="max-width: 80px;max-height: 60px;" src="'+(t.thumbnail.length?t.thumbnail:"/Modules/Core/Assets/images/no-image.png")+'" class="img-responsive">'}}:"product-category"==this.config.source||"post-category"==this.config.source?{data:null,orderable:!0,searchable:!1,name:"photo",render:function(t){return'<img style="max-width: 80px;max-height: 60px;" src="'+(t.photo.length?t.photo:"/Modules/Core/Assets/images/no-image.png")+'" class="img-responsive">'}}:"product-group"==this.config.source||"post-group"==this.config.source?{data:null,orderable:!0,searchable:!1,render:function(t){return'<img style="max-width: 80px;max-height: 60px;" src="/Modules/Core/Assets/images/no-image.png" class="img-responsive">'}}:{data:null,orderable:!1,searchable:!1,render:function(t){return'<img style="max-width: 80px;max-height: 60px;" src="/Modules/Core/Assets/images/no-image.png" class="img-responsive">'}}},loadCheckBoxColumn:function(){return{data:null,orderable:!1,searchable:!1,render:function(t){return'<div class="checkbox"><label><input type="checkbox" value="'+t.id+'"></label></div>'}}},applyItem:function(t){"single"===this.config.model?this.singleApply(t):this.multiApply(t)},singleApply:function(t){var e=$(t.currentTarget),a=e.find("input[type=hidden]"),n=a.val(),i=e.html();this.$container.find("#btnShowSearchBox").html(i),this.config.applied_ids=[Number(n)],this.writeAppliedIdToInput()},multiApply:function(t){t.stopPropagation();var e=this,a=$(t.currentTarget),n=a.find("input[type=hidden]"),i=Number(n.val());-1==this.config.applied_ids.indexOf(i)&&this.config.applied_ids.push(i),setTimeout(function(){e.reloadApplyTable(),e.reloadSearchTable(),e.writeAppliedIdToInput()},50)},unapplyItem:function(t){var e=this,a=$(t.currentTarget);a.attr("disabled","disabled");var n=a.data("id"),i=this.config.applied_ids.indexOf(n);i>-1&&this.config.applied_ids.splice(i,1),setTimeout(function(){e.reloadApplyTable(),e.reloadSearchTable(),e.writeAppliedIdToInput()},50)},updateAjaxSource:function(t){var e=this.config.ajax,a=this.config.applied_ids,n=new RegExp("([?&])"+t+"=.*?(&|$)","i"),i=-1!==e.indexOf("?")?"&":"?";return e.match(n)?e.replace(n,"$1"+t+"="+a+"$2"):e+i+t+"="+a},getAppliedIds:function(){return this.config.applied_ids},setAppliedIds:function(t){t instanceof Array&&(this.config.applied_ids=t)},showApplyBox:function(){this.$container.removeClass("hidden")},hideApplyBox:function(){this.$container.addClass("hidden")}};var WBApplyTable=new WbApplyTableClass,WBClass=function(){this.init()};WBClass.prototype={init:function(){this.activeMenu()},activeMenu:function(){var t=window.location.pathname,e=new RegExp(t.replace(/\/$/,"")+"$");$(".navigation-main a").each(function(){e.test(this.href.replace(/\/$/,""))&&$(this).parent("li").addClass("active")})}};var WB=new WBClass,removeArrayItem=function(t,e){if(t.constructor!==Array)return t;var a=t.indexOf(e);return a>-1&&t.splice(a,1),t},currencyFormat=function(t){return isNaN(t)?0:String(t).replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")};$(document).on("click","a.remove_item",function(t){var e=$(this).attr("href"),a=$(this).closest("td").attr("rowspan")||0,n=$(this).closest("tr"),i=$(this).data();return i._token=_token,swal({showLoaderOnConfirm:!0,closeOnConfirm:!1,title:i.title?i.title:"Bạn có chắc thực hiện thao tác xóa không ?",text:i.message?i.message:"Bạn sẽ không thể lấy lại được dữ liệu này !",type:"warning",showCancelButton:!0,confirmButtonColor:"#FF7043",cancelButtonText:"Không",confirmButtonText:"Có"},function(){$.ajax({url:e,type:"DELETE",dataType:"json",data:i,success:function(t){if(swal.close(),i.redirect)window.location=i.redirect;else if(t.redirect)window.location=t.redirect;else if(t.reload)WBDatatables.reloadData();else{for(var e=1;e<a;e++)n.next("tr").remove();n.remove()}},error:function(){swal.close()}})}),!1}),String.prototype.replaceAll=function(t,e,a){return this.replace(new RegExp(t.replace(/([\/\,\!\\\^\$\{\}\[\]\(\)\.\*\+\?\|\<\>\-\&])/g,"\\$&"),a?"gi":"g"),"string"==typeof e?e.replace(/\$/g,"$$$$"):e)},$(".button_submit_form").click(function(t){var e=$(this).data("modal");t.preventDefault();var a=Ladda.create(this);a.start();var n=$("#"+$(this).data("form"));n.ajaxSubmit({beforeSerialize:function(){for(instance in CKEDITOR.instances)CKEDITOR.instances[instance].updateElement();return!0},beforeSubmit:function(t,e,a){$('input[bs-type="singleDatePicker"]').each(function(){""!=$(this).val()&&t.push({name:$(this).attr("name"),value:moment($(this).val(),"DD-MM-YYYY HH:mm:ss").format("YYYY-MM-DD HH:mm:ss")})})},success:function(t){a.stop(),e&&$("#"+e).modal("hide"),t.redirect?location.href=t.redirect:(t.reload&&WBDatatables.reloadData(),t.errors?errorNotice(t.errors):successNotice("Cập nhật thành công"))},error:function(t){a.stop(),WBForm.showError(n,t)}})}),$(document).ready(function(){var t=localStorage.getItem("closedAdminMenu")||"[]";t=JSON.parse(t),t.forEach(function(t){$("[data-group-key='"+t+"']").not(".uncollapsible").removeClass("active").children("ul").slideUp(250)}),$(".navigation-main").find("li").has("ul").children("a").on("click",function(t){t.preventDefault();var e=localStorage.getItem("closedAdminMenu")||"[]";e=JSON.parse(e);var a=$(this).parent("li"),n=$(this).parent("li").data("group-key");if(n&&!a.hasClass("uncollapsible")){var i=e.indexOf(n);a.hasClass("active")?i>=0&&e.splice(i,1):i<0&&e.push(n),localStorage.setItem("closedAdminMenu",JSON.stringify(e))}})}),$(".sidebar-main-toggle").on("click",function(t){t.preventDefault(),$(".navigation .menu-group-label i").each(function(t,e){$(e).hasClass("hidden")?$(e).removeClass("hidden"):$(e).addClass("hidden")}),$(".navigation").hasClass("navigation-closed")?$(".navigation").removeClass("navigation-closed"):$(".navigation").addClass("navigation-closed")});